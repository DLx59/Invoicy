<div class="invoice-component p-5 flex flex-col flex-1 min-h-screen h-full">
  <div class="flex flex-col lg:rounded-t-2xl bg-primary-gradient bg-gray-900 gap-2 p-5">
    <div class="flex flex-row justify-between">
      <h1>Factures (
        @if (invoices().length > 0) {
          {{ invoices().length }}
        } @else {
          0
        }
        )</h1>
      <span>test</span>
    </div>
  </div>

  <div class="flex flex-col flex-1 lg:rounded-b-2xl gap-2 bg-slate-800 p-5">
    @if (invoices().length === 0) {
      <img src="assets/img/empty_illustration.png" alt="undraw invoice" class="w-96"/>
      <span class="font-bold">Créez une facture</span>
      <span>Créez et envoyez vos factures à vos clients en toute simplicité</span>
      <p-button [icon]="'pi pi-plus'" label="Créer une facture" severity="primary" class="mt-3" rounded/>
    } @else {
      @if (!isLoading()) {
        @for (invoice of invoices(); track invoice.invoiceNumber) {
          <div class="flex flex-col border border-gray-700 rounded gap-3 p-5 w-full">
            <div class="flex flex-row h-full justify-between">
              <div class="flex flex-col justify-between">
                <span>{{ invoice.client.name }}</span>
                <div class="flex flex-row gap-3">
                  <span><i class="pi pi-file me-2"></i>{{ invoice.dueAmount | currency:'EUR':'symbol':'1.2-2' }}
                    HT</span>
                  @if (!invoice.isIntracommunity) {
                    <span
                      class="small text-gray-400">{{ (invoice.dueAmount + invoice.dueVat) | currency:'EUR':'symbol':'1.2-2' }}
                      TTC</span>
                  }
                  <span><i class="pi pi-clock me-2"></i>{{ invoice.issueDate | date : 'dd MMMM yyyy' }}</span>
                </div>
              </div>
              <div class="flex flex-col items-end">
                <p-menu #menu [model]="items" [popup]="true" />
                <p-button (click)="selectedInvoice.set(invoice); menu.toggle($event)" outlined icon="pi pi-ellipsis-v"/>
                <p-tag styleClass="w-32 mt-2" [severity]="getSeverityFromInvoiceStatus(invoice.status)" [value]="invoice.status"/>
              </div>
            </div>
          </div>
        }
      }
    }
  </div>
</div>

@if (showPdfPreviewModal()) {
  <app-pdf-preview-modal (isOpen)="refreshPdfDialogState($event)" (onDownload)="downloadPDF()"
                         [invoiceNumber]="selectedInvoice()!.invoiceNumber" [pdfSrc]="pdfSrc()"
                         [showDialog]="showPdfPreviewModal()"></app-pdf-preview-modal>
}
